[TOC]

## CAP 原则

CAP 原则又称 CAP 定理，指的是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）这三个要素最多只能同时实现两个，不可能三者兼顾。

一致性：分布式系统中的所有数据备份，在同一时刻是否是同样的值。

可用性：在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。

分区容错性：系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。

## BASE 理论

BASE是 Basically Available（基本可用）、Soft state（软状态）和 Eventually consistent（最终一致性）三个短语的简写。其核心思想是即使一个系统无法做到强一致性（Strong consistency），也要采用适当的方式来使系统达到最终一致性（Eventual consistency）

- 基本可用：分布式系统在出现不可预知故障的时候，允许损失部分可用性，而不是不可用。
- 最终一致性：分布式系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态
- 软状态：响应时间变慢、功能降级

## 分布式锁的实现方式

参考优秀博客：http://www.hollischuang.com/archives/1716

1. 基于数据库实现分布式锁 
2. 基于缓存实现分布式锁（Redis 使用 Redlock）
3. 基于 Zookeeper 实现分布式锁

最好使用 Zookeeper 实现分布式锁。

## 如何保证分布式 session 的一致性

由于 session 是保存在服务器上，而在分布式环境下，每台服务器的 session 是不一样的，所以要保证 session 的一致性，可以采取以下措施：

- 使用 nginx ip hash 负载均衡策略，保证每个请求转发到固定的服务器
- 将 session 保存到 redis 缓存中

